<!--
 * Andrey Pudov Official Website
 *
 * The MIT License
 *
 * Copyright 2011-2015 Andrey Pudov.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
-->
<!DOCTYPE html>
<html>
  <head>
    <title>Andrey Pudov - POSIX Threads in Fortran</title>
    
    <meta charset='utf-8' />
    <meta http-equiv='X-UA-Compatible' content='IE=edge' />
    
    <meta name='viewport'    content='width=device-width, initial-scale=1.0' />
    <meta name='description' content='Official Andrey Pudov website featuring Andrey Pudov news, photo albums and more.' />
    <meta name='author'      content='Andrey Pudov' />
    
    <!-- bootstrap core style sheet -->
    <link href='../libraries/bootstrap/css/bootstrap.css' rel='stylesheet' />

    <!-- web page specific styles declaration -->
    
    
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js'></script>
      <script src='https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js'></script>
    <![endif]-->

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
      (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
        try {
          w.yaCounter22906810 = new Ya.Metrika({id:22906810,
            webvisor:true,
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true});
        } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
      })(document, window, "yandex_metrika_callbacks");
    </script>
    <noscript><div><img src="//mc.yandex.ru/watch/22906810" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74198577-1', 'auto');
      ga('send', 'pageview');

    </script>
    <!-- /Google Analytics -->
  </head>
    <body>
      <div id='page'>
        <div id='header'>
          <div class='navbar-wrapper'>
    <div class='container'>
        <div class='navbar navbar-static-top' role='navigation'>
            <div class='container'>
                <div class='navbar-header'>
                    <button type='button' class='navbar-toggle' data-toggle='collapse' data-target='.navbar-collapse'>
                        <span class='sr-only'>Toggle navigation</span>
                        <span class='icon-bar'></span>
                        <span class='icon-bar'></span>
                        <span class='icon-bar'></span>
                    </button>
                    <a href='../index.html' class='navbar-brand'>Andrey Pudov</a>
                </div>
                <div class='navbar-collapse collapse'>
                    <ul class='nav navbar-nav'>
                        <li class='active'><a href='../albums.html'>Albums</a></li>
	                    <li><a href='../contents.html'>Contents</a></li>
	                    <li><a href='../resume.html'>Resume</a></li>
	                    <li><a href='../contact.html'>Contact</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

        </div>
        <div id='content'>
          <div class='container'>
          <div class='page-header'>
            <h1>POSIX Threads in Fortran<small><em>Sunday, February 22, 2015</em></small></h1>
          </div>

          <blockquote class="blockquote-reverse">
            <p>“Begin at the beginning,” the King said gravely, “and go on till you come to the end: then stop.”</p>
            <footer>Alice’s Adventures in Wonderland</footer>
          </blockquote>

          <p>Parallel programming in Fortran is mostly focused on the use of technologies such as OpenMP, that implements a set of compiler directives, library routines, and environment variables that provides an API for multi-platform shared memory multiprocessing programming, and OpenMPI, a library implements a language-independent communications protocol used to program parallel computers. However, applied problems often require the use of manual and flexible task management, and one of the possible technologies can be used is POSIX Threads, a set of C programming language types, functions and constants implements an API for creating multi-threaded applications.</p>

          <p>Implementations of the Pthreads library are available on many POSIX - conformant operating systems, and therefore, available for a wide range of programming languages. Unfortunately, only a few Fortran compilers provides a native interface for Pthreads. In this article I will discuss a simple example implementation of an interface to the Pthreads library that can be used in Fortran programs and an example of Ping Pong game,  where two simultaneously executable thread display a message.</p>

          <p>Due to significant differences between C and Fortran programming languages, primarily in the implementation of pointers and arrays, a call to function written in C requires a pre-processing for values passed between functions. The proposed interface for Fortran implementation of POSIX threads based on three levels of abstraction. The first is a pre-processing, provides a helper code. The second layer provides an interface for calling C functions from programs written in Fortran language. The third layer is implements a post-processing and directly calls the desired function of the PThreads library.</p>

          <p>Lets consider an example of pthread_create wrapper implementation used to create a new thread of execution in the calling process. At the stage of pre-processing a pointer to a procedure is added to the table of functions, including specified argument:</p>

          <pre style="background:#fff;color:#000;border:0;">    <span style="color:#00f;font-weight:700">subroutine</span> <span style="color:#0000a2;font-weight:700">pthread_create</span>(<span style="font-style:italic">thread_id, attr_id, routine, argument, info</span>)
        <span style="color:#00f;font-weight:700">integer</span>, <span style="color:#00f;font-weight:700">intent</span>(<span style="color:#00f;font-weight:700">out</span>) <span style="color:#00f;font-weight:700">::</span> thread_id
        <span style="color:#00f;font-weight:700">integer</span>, <span style="color:#00f;font-weight:700">intent</span>(<span style="color:#00f;font-weight:700">in</span>)  <span style="color:#00f;font-weight:700">::</span> attr_id
        <span style="color:#00f;font-weight:700">procedure</span>(IRunnable) <span style="color:#00f;font-weight:700">::</span> routine
        <span style="color:#00f;font-weight:700">integer</span>, target      <span style="color:#00f;font-weight:700">::</span> argument
        <span style="color:#00f;font-weight:700">integer</span>, <span style="color:#00f;font-weight:700">intent</span>(<span style="color:#00f;font-weight:700">out</span>) <span style="color:#00f;font-weight:700">::</span> info

        <span style="color:#00f;font-weight:700">procedure</span>(IRunnableRoutine), bind(c), <span style="color:#00f;font-weight:700">pointer</span> <span style="color:#00f;font-weight:700">::</span> routine_ptr
        <span style="color:#00f;font-weight:700">type</span>(TRunnablePointer), dimension(:), pointer :: buffer
        <span style="color:#00f;font-weight:700">integer</span>                                       <span style="color:#00f;font-weight:700">::</span> index

        <span style="color:#00f;font-weight:700">call</span> thread_mutex_lock(routine_table_mutex, info)

        <span style="color:#00f;font-weight:700">call</span> thread_alloc(thread_id, info)
        <span style="color:#00f;font-weight:700">if</span> (thread_id <span style="color:#00f;font-weight:700">.gt.</span> routine_table_size) <span style="color:#00f;font-weight:700">then</span>
            nullify(buffer)
            <span style="color:#00f;font-weight:700">allocate</span>(buffer(routine_table_size <span style="color:#00f;font-weight:700">*</span> <span style="color:#0000cd">2</span>))

            <span style="color:#00f;font-weight:700">do</span> index <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">1</span>, routine_table_size
                buffer(index) <span style="color:#00f;font-weight:700">=</span> routine_table(index)
            <span style="color:#00f;font-weight:700">end do</span>

            <span style="color:#00f;font-weight:700">deallocate</span>(routine_table)
            routine_table <span style="color:#00f;font-weight:700">=</span>> buffer
            routine_table_size <span style="color:#00f;font-weight:700">=</span> routine_table_size <span style="color:#00f;font-weight:700">*</span> <span style="color:#0000cd">2</span>
        <span style="color:#00f;font-weight:700">endif</span>

        <span style="color:#00f;font-weight:700">allocate</span>(routine_table(thread_id)<span style="color:#00f;font-weight:700">%</span>value)
        routine_table(thread_id)<span style="color:#00f;font-weight:700">%</span>value<span style="color:#00f;font-weight:700">%</span>run      <span style="color:#00f;font-weight:700">=</span>> routine
        routine_table(thread_id)<span style="color:#00f;font-weight:700">%</span>value<span style="color:#00f;font-weight:700">%</span>argument <span style="color:#00f;font-weight:700">=</span>> argument
        routine_ptr <span style="color:#00f;font-weight:700">=</span>> start_routine

        <span style="color:#00f;font-weight:700">call</span> thread_create(thread_id, attr_id, c_funloc(routine_ptr), &amp;
                c_loc(routine_table(thread_id)<span style="color:#00f;font-weight:700">%</span>value), info)

        <span style="color:#00f;font-weight:700">call</span> thread_mutex_unlock(routine_table_mutex, info)
    <span style="color:#00f;font-weight:700">end</span> <span style="color:#00f;font-weight:700">subroutine</span>

</pre>

          <p>The second level is much easier than other two and only declares the interface for the functions implemented on the third level, written in C:</p>

          <pre style="background:#fff;color:#000;border:0;">   <span style="color:#00f;font-weight:700">subroutine</span> <span style="color:#0000a2;font-weight:700">thread_create</span>(<span style="font-style:italic">thread_id, attribute_id, routine, argument, info</span>) bind(c)
        <span style="color:#00f;font-weight:700">use</span> iso_c_binding
        <span style="color:#00f;font-weight:700">integer</span>(c_int),     <span style="color:#00f;font-weight:700">intent</span>(<span style="color:#00f;font-weight:700">in</span>)  <span style="color:#00f;font-weight:700">::</span> thread_id
        <span style="color:#00f;font-weight:700">integer</span>(c_int),     <span style="color:#00f;font-weight:700">intent</span>(<span style="color:#00f;font-weight:700">in</span>)  <span style="color:#00f;font-weight:700">::</span> attribute_id
        <span style="color:#00f;font-weight:700">type</span>(c_funptr),     intent(in)  :: routine
        <span style="color:#00f;font-weight:700">type</span>(c_ptr), value, intent(in)  :: argument
        <span style="color:#00f;font-weight:700">integer</span>(c_int),     <span style="color:#00f;font-weight:700">intent</span>(<span style="color:#00f;font-weight:700">out</span>) <span style="color:#00f;font-weight:700">::</span> info
    <span style="color:#00f;font-weight:700">end</span> <span style="color:#00f;font-weight:700">subroutine</span>
          </pre>

          <p>The post-processing on the third level is validates the status of threads, passed arguments, also adds those entries to the appropriate tables and directly calls the desired function:</p>

          <pre style="background:#fff;color:#000;border:0;"><span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">thread_create</span>(int *thread_id, int *attribute_id, void *(**routine)(void *),
                   void *argument, int* info) {
    pthread_attr_t *attribute;
    int index = 0;
        *info = FT_OK;

    if (is_initialized == false) {
        *info = FT_EINIT;
        return;
    }

    if (<span style="color:#0000a2;font-weight:700">is_valid</span>(threads, *thread_id) == false) {
        *info = FT_EINVALID;
        return;
    }

    pthread_mutex_lock(&amp;(threads->mutex));
    if (*attribute_id == -1) {
        attribute = (pthread_attr_t*) malloc(<span style="color:#00f;font-weight:700">sizeof</span>(pthread_attr_t));
        pthread_attr_init(attribute);
        pthread_attr_setdetachstate(attribute, PTHREAD_CREATE_JOINABLE);
    } else {
        if (<span style="color:#0000a2;font-weight:700">is_valid</span>(thread_attributes, *attribute_id) == false) {
            pthread_mutex_unlock(&amp;(threads->mutex));
            *info = FT_EINVALID;
            return;
        }

        attribute = thread_attributes->data[*attribute_id];
    }

    *info = pthread_create(threads->data[*thread_id], attribute, (*routine), argument);
    if (*attribute_id == -1) {
        free(attribute);
    }

    if (*info) {
        pthread_mutex_unlock(&amp;(threads->mutex));
        return;
    }

    pthread_mutex_unlock(&amp;(threads->mutex));
}

          </pre>

          <p>Next, lets consider the use of POSIX threads to write a simple Ping Pong game where two created threads are waiting each other and alternately outputs its name to console:</p>

          <pre style="background:#fff;color:#000;border:0;"><span style="color:#06f;font-style:italic">!</span>
<span style="color:#06f;font-style:italic">! The Laboratory of Algorithms</span>
<span style="color:#06f;font-style:italic">!</span>
<span style="color:#06f;font-style:italic">! The MIT License</span>
<span style="color:#06f;font-style:italic">!</span>
<span style="color:#06f;font-style:italic">! Copyright 2011-2015 Andrey Pudov.</span>
<span style="color:#06f;font-style:italic">!</span>
<span style="color:#06f;font-style:italic">! Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span style="color:#06f;font-style:italic">! of this software and associated documentation files (the 'Software'), to deal</span>
<span style="color:#06f;font-style:italic">! in the Software without restriction, including without limitation the rights</span>
<span style="color:#06f;font-style:italic">! to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span style="color:#06f;font-style:italic">! copies of the Software, and to permit persons to whom the Software is</span>
<span style="color:#06f;font-style:italic">! furnished to do so, subject to the following conditions:</span>
<span style="color:#06f;font-style:italic">!</span>
<span style="color:#06f;font-style:italic">! The above copyright notice and this permission notice shall be included in</span>
<span style="color:#06f;font-style:italic">! all copies or substantial portions of the Software.</span>
<span style="color:#06f;font-style:italic">!</span>
<span style="color:#06f;font-style:italic">! THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span style="color:#06f;font-style:italic">! IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span style="color:#06f;font-style:italic">! FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span style="color:#06f;font-style:italic">! AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span style="color:#06f;font-style:italic">! LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span style="color:#06f;font-style:italic">! OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span style="color:#06f;font-style:italic">! THE SOFTWARE.</span>
<span style="color:#06f;font-style:italic">!</span>

<span style="color:#00f;font-weight:700">module</span> MEPingPong

    <span style="color:#00f;font-weight:700">use</span> MPThreads

    <span style="color:#00f;font-weight:700">implicit none</span>
    <span style="color:#00f;font-weight:700">private</span>

    <span style="color:#00f;font-weight:700">logical</span> <span style="color:#00f;font-weight:700">::</span> pingpong <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">.false.</span>
    <span style="color:#00f;font-weight:700">integer</span> <span style="color:#00f;font-weight:700">::</span> mutex

    type, <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">::</span> TEPingPong
    <span style="color:#00f;font-weight:700">contains</span>
        <span style="color:#00f;font-weight:700">procedure</span> <span style="color:#00f;font-weight:700">::</span> present
    end type
<span style="color:#00f;font-weight:700">contains</span>
    <span style="color:#00f;font-weight:700">subroutine</span> <span style="color:#0000a2;font-weight:700">present</span>(<span style="font-style:italic">instance</span>)
        class(TEPingPong), <span style="color:#00f;font-weight:700">intent</span>(<span style="color:#00f;font-weight:700">in</span>) <span style="color:#00f;font-weight:700">::</span> instance

        <span style="color:#00f;font-weight:700">integer</span> pinger
        <span style="color:#00f;font-weight:700">integer</span> ponger

        <span style="color:#00f;font-weight:700">integer</span> attribute_id
        <span style="color:#00f;font-weight:700">integer</span> argument
        <span style="color:#00f;font-weight:700">integer</span>, target  <span style="color:#00f;font-weight:700">::</span> result
        <span style="color:#00f;font-weight:700">integer</span>, pointer <span style="color:#00f;font-weight:700">::</span> result_pointer
        <span style="color:#00f;font-weight:700">integer</span> info

        argument     <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>
        attribute_id <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">-</span><span style="color:#0000cd">1</span>
        result_pointer <span style="color:#00f;font-weight:700">=</span>> result

        <span style="color:#00f;font-weight:700">call</span> pthread_init(info)
        <span style="color:#00f;font-weight:700">if</span> (info <span style="color:#00f;font-weight:700">.ne.</span> <span style="color:#0000cd">0</span>) <span style="color:#00f;font-weight:700">then</span>
            <span style="color:#00f;font-weight:700">print</span> <span style="color:#00f;font-weight:700">*</span>, <span style="color:#036a07">'Error initializing.'</span>
            <span style="color:#00f;font-weight:700">return</span>
        <span style="color:#00f;font-weight:700">end if</span>

        <span style="color:#00f;font-weight:700">call</span> pthread_mutex_init(mutex, attribute_id, info)

        <span style="color:#00f;font-weight:700">call</span> pthread_create(pinger, attribute_id, ping, argument, info)
        <span style="color:#00f;font-weight:700">call</span> pthread_create(ponger, attribute_id, pong, argument, info)
        <span style="color:#00f;font-weight:700">if</span> (info <span style="color:#00f;font-weight:700">.ne.</span> <span style="color:#0000cd">0</span>) <span style="color:#00f;font-weight:700">then</span>
            <span style="color:#00f;font-weight:700">print</span> <span style="color:#00f;font-weight:700">*</span>, <span style="color:#036a07">'Error creating threads.'</span>
        <span style="color:#00f;font-weight:700">endif</span>

        <span style="color:#00f;font-weight:700">call</span> pthread_join(pinger, result_pointer, info)
        <span style="color:#00f;font-weight:700">call</span> pthread_join(ponger, result_pointer, info)
        <span style="color:#00f;font-weight:700">if</span> (info <span style="color:#00f;font-weight:700">.ne.</span> <span style="color:#0000cd">0</span>) <span style="color:#00f;font-weight:700">then</span>
            <span style="color:#00f;font-weight:700">print</span> <span style="color:#00f;font-weight:700">*</span>, <span style="color:#036a07">'Error joining threads.'</span>
        <span style="color:#00f;font-weight:700">endif</span>

        <span style="color:#00f;font-weight:700">call</span> pthread_mutex_destroy(mutex, info)
        <span style="color:#00f;font-weight:700">call</span> pthread_destroy(info)
        <span style="color:#00f;font-weight:700">if</span> (info <span style="color:#00f;font-weight:700">.ne.</span> <span style="color:#0000cd">0</span>) <span style="color:#00f;font-weight:700">then</span>
            <span style="color:#00f;font-weight:700">print</span> <span style="color:#00f;font-weight:700">*</span>, <span style="color:#036a07">'Error destroying.'</span>
        <span style="color:#00f;font-weight:700">endif</span>
    <span style="color:#00f;font-weight:700">end</span> <span style="color:#00f;font-weight:700">subroutine</span>

    <span style="color:#00f;font-weight:700">subroutine</span> <span style="color:#0000a2;font-weight:700">ping</span>(<span style="font-style:italic">argument</span>)
        <span style="color:#00f;font-weight:700">integer</span> <span style="color:#00f;font-weight:700">::</span> argument
        <span style="color:#00f;font-weight:700">integer</span> index
        <span style="color:#00f;font-weight:700">integer</span> info
        <span style="color:#00f;font-weight:700">integer</span>, target  <span style="color:#00f;font-weight:700">::</span> status
        <span style="color:#00f;font-weight:700">integer</span>, pointer <span style="color:#00f;font-weight:700">::</span> status_pointer

        status_pointer <span style="color:#00f;font-weight:700">=</span>> status
        status         <span style="color:#00f;font-weight:700">=</span>  <span style="color:#0000cd">0</span>

        <span style="color:#00f;font-weight:700">do</span> index <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">1</span>, <span style="color:#0000cd">10</span>
            <span style="color:#00f;font-weight:700">call</span> pthread_mutex_lock(mutex, info)

            <span style="color:#00f;font-weight:700">if</span> (pingpong) <span style="color:#00f;font-weight:700">then</span>
                <span style="color:#00f;font-weight:700">print</span> <span style="color:#00f;font-weight:700">*</span>, <span style="color:#036a07">'Ping'</span>
                pingpong <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">.false.</span>
            <span style="color:#00f;font-weight:700">end if</span>

            <span style="color:#06f;font-style:italic">! additional async output</span>
            <span style="color:#00f;font-weight:700">print</span> <span style="color:#00f;font-weight:700">*</span>, <span style="color:#036a07">''</span>

            <span style="color:#00f;font-weight:700">call</span> pthread_mutex_unlock(mutex, info)
        <span style="color:#00f;font-weight:700">end do</span>

        <span style="color:#00f;font-weight:700">call</span> pthread_exit(status_pointer)
    <span style="color:#00f;font-weight:700">end</span> <span style="color:#00f;font-weight:700">subroutine</span>

    <span style="color:#00f;font-weight:700">subroutine</span> <span style="color:#0000a2;font-weight:700">pong</span>(<span style="font-style:italic">argument</span>)
        <span style="color:#00f;font-weight:700">integer</span> <span style="color:#00f;font-weight:700">::</span> argument
        <span style="color:#00f;font-weight:700">integer</span> index
        <span style="color:#00f;font-weight:700">integer</span> info
        <span style="color:#00f;font-weight:700">integer</span>, target  <span style="color:#00f;font-weight:700">::</span> status
        <span style="color:#00f;font-weight:700">integer</span>, pointer <span style="color:#00f;font-weight:700">::</span> status_pointer

        status_pointer <span style="color:#00f;font-weight:700">=</span>> status
        status         <span style="color:#00f;font-weight:700">=</span>  <span style="color:#0000cd">0</span>

        <span style="color:#00f;font-weight:700">do</span> index <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">1</span>, <span style="color:#0000cd">10</span>
            <span style="color:#00f;font-weight:700">call</span> pthread_mutex_lock(mutex, info)

            <span style="color:#00f;font-weight:700">if</span> (pingpong <span style="color:#00f;font-weight:700">.ne.</span> <span style="color:#585cf6;font-weight:700">.true.</span>) <span style="color:#00f;font-weight:700">then</span>
                <span style="color:#00f;font-weight:700">print</span> <span style="color:#00f;font-weight:700">*</span>, <span style="color:#036a07">'Pong'</span>
                pingpong <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">.true.</span>
            <span style="color:#00f;font-weight:700">end if</span>

            <span style="color:#00f;font-weight:700">call</span> pthread_mutex_unlock(mutex, info)
        <span style="color:#00f;font-weight:700">end do</span>

        <span style="color:#00f;font-weight:700">call</span> pthread_exit(status_pointer)
    <span style="color:#00f;font-weight:700">end</span> <span style="color:#00f;font-weight:700">subroutine</span>
<span style="color:#00f;font-weight:700">end module</span>

</pre>

          <p>In this example, the main procedure present initializes the mutex and then creates two threads. Each thread invokes a procedure specified as an argument. Accordingly, the first thread executes the procedure pinger and second, as you can guess, the procedure ponger:</p>

          <pre style="background:#fff;color:#000;border:0;"><span style="color:#00f;font-weight:700">call</span> pthread_create(pinger, attribute_id, ping, argument, info)
<span style="color:#00f;font-weight:700">call</span> pthread_create(ponger, attribute_id, pong, argument, info)
          </pre>

          <p>Both procedures first, locks the mutex and then prints the message on the screen. Because only one thread can own a mutex, the second thread is always waiting queue on the right to mutex, that leads to the exchange of this right between threads and in our case, the alternately outputs message.</p>

          <p>This interface implementation is based on the work of <a href='https://github.com/ohm314/forthreads'>Omar Awile</a>, computer scientist specializing in high-performance computing, and contains only a basic example of using POSIX threads in programs written in Fortran. The source code of the interface and the example is available in the repository: <a href='https://github.com/andreypudov/Algorithms'>https://github.com/andreypudov/Algorithms</a> - Core/Threads directory provides implementation of the interface, and Examples/PingPong.f file presents the game.</p>
        </div>
        </div>
        <div id='footer'>
          <div class='container'>
    <footer>
        <hr class='footer-divider' />

        <ul class='piped-links pull-right'>
            <li class='first piped-links-short'><a href='../resume.html'>About</a></li>
            <li class='first piped-links-long'><a href='../resume.html'>About Andrey Pudov</a></li>
            <li><a href='../contact.html'>Contact</a></li>
        </ul>

        <ul class='piped-links'>
            <p class='piped-links-long'>Copyright &#169; 2016 Andrey Pudov. All rights reserved.</p>
        </ul>

        <p class='piped-links-short'>&#169; 2016 Andrey Pudov. All rights reserved.</p>
    </footer>

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src='../libraries/jquery/jquery-1.11.3.min.js'></script>
    <!-- <script src='../libraries/jquery/jquery.validate.min.js'></script> -->

    <!-- <script src='../libraries/bootstrap/js/bootstrap.min.js'></script> -->

    <script src='../libraries/bootstrap/js/collapse.js' ></script>
    <script src='../libraries/bootstrap/js/dropdown.js' ></script>
    <script src='../libraries/bootstrap/js/transition.js' ></script>

    <!-- web page specific scripts declaration -->
    

    <!-- common on init functions -->
    <script src='../scripts/init.js'></script>
</div>
                 
        </div>
      </div>
    </body>
</html>
