<!--
 * Andrey Pudov Official Website
 *
 * The MIT License
 *
 * Copyright 2011-2016 Andrey Pudov.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
-->
<!DOCTYPE html>
<html>
  <head>
    <title>Andrey Pudov - XML Parser in C</title>
    
    <meta charset='utf-8' />
    <meta http-equiv='X-UA-Compatible' content='IE=edge' />
    
    <meta name='viewport'    content='width=device-width, initial-scale=1.0' />
    <meta name='description' content='Official Andrey Pudov website featuring Andrey Pudov news, photo albums and more.' />
    <meta name='author'      content='Andrey Pudov' />
    
    <!-- bootstrap core style sheet -->
    <link href='../libraries/bootstrap/css/bootstrap.css' rel='stylesheet' />

    <!-- web page specific styles declaration -->
    
    
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js'></script>
      <script src='https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js'></script>
    <![endif]-->

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74198577-1', 'auto');
      ga('send', 'pageview');

    </script>
    <!-- /Google Analytics -->
  </head>
    <body>
      <div id='page'>
        <div id='header'>
          <div class='navbar-wrapper'>
    <div class='container'>
        <div class='navbar navbar-static-top' role='navigation'>
            <div class='container'>
                <div class='navbar-header'>
                    <button type='button' class='navbar-toggle' data-toggle='collapse' data-target='.navbar-collapse'>
                        <span class='sr-only'>Toggle navigation</span>
                        <span class='icon-bar'></span>
                        <span class='icon-bar'></span>
                        <span class='icon-bar'></span>
                    </button>
                    <a href='../index.html' class='navbar-brand'>Andrey Pudov</a>
                </div>
                <div class='navbar-collapse collapse'>
                    <ul class='nav navbar-nav'>
                        <li class='active'><a href='../albums.html'>Albums</a></li>
	                    <li><a href='../contents.html'>Contents</a></li>
	                    <li><a href='../resume.html'>Resume</a></li>
	                    <li><a href='../contact.html'>Contact</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

        </div>
        <div id='content'>
          <div class='container'>
          <div class='page-header'>
            <h1>XML Parser in C - Usage and Examples<small><em>Monday, July 30, 2012</em></small></h1>
          </div>

          <p>One of the first things you will have to do when dealing with XML programmatically is take an XML document and parse it. The post will show the basics of XML parsing, using the easiest methods. We will look closely at two simple examples of how to use XML parser described in <a href='../p/xml-parser-in-c.html'>previous post</a> to parse an XML file.</p>

          <p>To process the XML we shall create an XMLReader to read the XML file content info temporary buffer. The read() function in XMLReader return an XMLDocument structure - the pointer to the top of parsed XML content. If an error occurs during parsing (for example, if the XML is not well-formated), the XMLReader will return a Null pointer.</p>

          <p>The XMLDocument is high-level container for the XML data, that contains a list of XMLElements. Each XML documents begins with an identification element - "XML DOCUMENT v1.0". After identification string XML document shall contain an XML declaration, that indicates the version of XML used  in the document.</p>

          <p>To get the top element of the XML document we have to use document_get_element() function. We have then use the element_get_element() function of the XMLElement structure to going through XML document and retrieve the data we need. Each XML container structure such as XMLDocument, XMLElement and XMLAttribute provides similar API to work with container elements - on a first call with Null argument for requested element, the function returns the first element in this container. Each subsequent call of the function shall contains returned value as argument to retrieve next element. The end element of the container is Null pointer.</p>

          <h2>Example 1. Parsing sequential XML document</h2>

          <p>The first example simply displays the XML content stored in /tmp/installer-xml_reader_example1 file.</p>

          <h3>Input:</h3>

          <pre style="background:#fff;color:#000;border:0;"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">"1.0"</span><span style="color:#888"> encoding</span>=<span style="color:#888">"UTF-8"</span>?></span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">config</span>></span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">entry</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">"Key1"</span> <span style="font-style:italic">Value</span>=<span style="color:#036a07">"Value1"</span>></span>Entry1<span style="color:#1c02ff">&lt;/<span style="font-weight:700">entry</span>></span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">entry</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">"Key2"</span> <span style="font-style:italic">Value</span>=<span style="color:#036a07">"Value2"</span>></span>Entry2<span style="color:#1c02ff">&lt;/<span style="font-weight:700">entry</span>></span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">entry</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">"Key3"</span> <span style="font-style:italic">Value</span>=<span style="color:#036a07">"Value3"</span>></span>Entry3<span style="color:#1c02ff">&lt;/<span style="font-weight:700">entry</span>></span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">config</span>></span>
</pre>

          <h3>Code</h3>

          <pre style="background:#fff;color:#000;border:0;">XMLReader    *reader    = <span style="color:#585cf6;font-weight:700">NULL</span>;
    XMLDocument  *document  = <span style="color:#585cf6;font-weight:700">NULL</span>;
    XMLElement   *element   = <span style="color:#585cf6;font-weight:700">NULL</span>;
    XMLElement   *element_t = <span style="color:#585cf6;font-weight:700">NULL</span>;
    XMLAttribute *attribute = <span style="color:#585cf6;font-weight:700">NULL</span>;
    
    wchar_t *element_name     = <span style="color:#585cf6;font-weight:700">NULL</span>;
    wchar_t *element_value    = <span style="color:#585cf6;font-weight:700">NULL</span>;
    wchar_t *attribute_name   = <span style="color:#585cf6;font-weight:700">NULL</span>;
    wchar_t *attribute_value  = <span style="color:#585cf6;font-weight:700">NULL</span>;

    <span style="color:#00f;font-weight:700">char</span> file_name[] = <span style="color:#036a07">"/tmp/installer-xml_reader_example1"</span>;

    <span style="color:#0000a2;font-weight:700">setlocale</span>(LC_ALL, "en_US.UTF-8");

    pointer = fopen(file_name, <span style="color:#036a07">"r"</span>);
    <span style="color:#00f;font-weight:700">if</span> (pointer == <span style="color:#585cf6;font-weight:700">NULL</span>) {
        fprintf(stderr, "[ERROR|%s] %s - %s\n",
                "u_installer_xml_example_example1", file_name, strerror(errno));
        return false;
    }
    
    <span style="color:#06f;font-style:italic">/* read the file and verifying the structure */</span>
    reader   = installer_xml_reader_new(pointer);
    <span style="color:#00f;font-weight:700">if</span> (reader == <span style="color:#585cf6;font-weight:700">NULL</span>) {
        u_installer_main_print("xml_example", "<span style="color:#0000a2;font-weight:700">example1</span>(1)", false);
        return false;
    }
    
    document = installer_xml_reader_read(reader);
    <span style="color:#00f;font-weight:700">if</span> ((document == <span style="color:#585cf6;font-weight:700">NULL</span>) || (document->elements == <span style="color:#585cf6;font-weight:700">NULL</span>)) {
        u_installer_main_print("xml_example", "<span style="color:#0000a2;font-weight:700">example1</span>(2)", false);
        return false;
    }
    
    <span style="color:#06f;font-style:italic">/* 
     * main example code 
     */</span>

    <span style="color:#06f;font-style:italic">/* XML DOCUMENT v1.0 */</span>
    element = installer_xml_document_get_element(document, <span style="color:#585cf6;font-weight:700">NULL</span>);
    element_name  = installer_xml_element_get_name(element);
    element_value = installer_xml_element_get_value(element);
    <span style="color:#0000a2;font-weight:700">printf</span>("%ls %ls\n", element_name, element_value);
    
    <span style="color:#06f;font-style:italic">/* &lt;?xml version="1.0" encoding="UTF-8"?> */</span>
    element_t = installer_xml_element_get_element(element, <span style="color:#585cf6;font-weight:700">NULL</span>);
    attribute = installer_xml_element_get_attribute(element_t, <span style="color:#585cf6;font-weight:700">NULL</span>);
    element_name    = installer_xml_element_get_name(element_t);
    attribute_name  = installer_xml_attribute_get_name(attribute);
    attribute_value = installer_xml_attribute_get_value(attribute);
    <span style="color:#0000a2;font-weight:700">printf</span>("&lt;?%ls %ls=\"%ls\" ", 
                    element_name, attribute_name, attribute_value);
    attribute = installer_xml_element_get_attribute(element_t, attribute);
    attribute_name  = installer_xml_attribute_get_name(attribute);
    attribute_value = installer_xml_attribute_get_value(attribute);
    <span style="color:#0000a2;font-weight:700">printf</span>("%ls=\"%ls\"?>\n", 
                    attribute_name, attribute_value);
    
    <span style="color:#06f;font-style:italic">/* &lt;config> */</span>
    element = installer_xml_element_get_element(element, element_t);
    <span style="color:#0000a2;font-weight:700">printf</span>("&lt;%ls>\n", installer_xml_element_get_name(element));
    
    <span style="color:#06f;font-style:italic">/* nullify temporary pointer to use it as iterator */</span>
    element_t = <span style="color:#585cf6;font-weight:700">NULL</span>;
    <span style="color:#00f;font-weight:700">while</span> ((element_t = installer_xml_element_get_element(element, element_t)) != <span style="color:#585cf6;font-weight:700">NULL</span>) {
        attribute = installer_xml_element_get_attribute(element_t, NULL);
        element_name    = installer_xml_element_get_name(element_t);
        element_value   = installer_xml_element_get_value(element_t);
        attribute_name  = installer_xml_attribute_get_name(attribute);
        attribute_value = installer_xml_attribute_get_value(attribute);
        printf("\t&lt;%ls %ls=\"%ls\" ", 
                    element_name, attribute_name, attribute_value);
        attribute = installer_xml_element_get_attribute(element_t, attribute);
        attribute_name  = installer_xml_attribute_get_name(attribute);
        attribute_value = installer_xml_attribute_get_value(attribute);
        printf("%ls=\"%ls\">%ls&lt;/%ls>\n", 
                    attribute_name, attribute_value, element_value, element_name);
    }
    
    <span style="color:#06f;font-style:italic">/* free memory and remove temporary file */</span>
    <span style="color:#0000a2;font-weight:700">installer_xml_reader_delete</span>(reader);
    <span style="color:#0000a2;font-weight:700">fclose</span>(pointer);
</pre>

          <h3>Output:</h3>
          
          <p>
            XML DOCUMENT v1.0<br />
            &lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />
            &lt;config&gt;<br />
              &lt;entry key="Key1" Value="Value1"&gt;Entry1&lt;/entry&gt;<br />
              &lt;entry key="Key2" Value="Value2"&gt;Entry2&lt;/entry&gt;<br />
              &lt;entry key="Key3" Value="Value3"&gt;Entry3&lt;/entry&gt;<br />
          </p>

          <h2>Example 2. Parsing nested XML document</h2>

          <p>The second example is more complicated, - for now we have nested nodes. This is real-world example of storing books data on Amazon website. This examples displays how to extract inheritance data by using while loop. You can replace printf() function to any other handler in your application to process XML data on your own.</p>

          <h3>Input:</h3>

          <pre style="background:#fff;color:#000;border:0;"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">"1.0"</span><span style="color:#888"> encoding</span>=<span style="color:#888">"UTF-8"</span>?></span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">books</span>></span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">category</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">"Art <span style="background:#900;color:#fff">&amp;</span> Photography"</span>></span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">book</span> <span style="font-style:italic">author</span>=<span style="color:#036a07">"Alex Johnson"</span> <span style="font-style:italic">published</span>=<span style="color:#036a07">"01 May 2012"</span>></span>Bookshelf<span style="color:#1c02ff">&lt;/<span style="font-weight:700">book</span>></span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">book</span> <span style="font-style:italic">author</span>=<span style="color:#036a07">"Andrew Blauner"</span> <span style="font-style:italic">published</span>=<span style="color:#036a07">"24 Apr 2012"</span>></span>Central Park<span style="color:#1c02ff">&lt;/<span style="font-weight:700">book</span>></span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">category</span>></span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">category</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">"Romance"</span>></span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">book</span> <span style="font-style:italic">author</span>=<span style="color:#036a07">"Gena Showalter"</span> <span style="font-style:italic">published</span>=<span style="color:#036a07">"05 Jul 2012"</span>></span>Wicked Nights<span style="color:#1c02ff">&lt;/<span style="font-weight:700">book</span>></span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">book</span> <span style="font-style:italic">author</span>=<span style="color:#036a07">"Elle Kennedy"</span> <span style="font-style:italic">published</span>=<span style="color:#036a07">"01 May 2012"</span>></span>Midnight Rescue<span style="color:#1c02ff">&lt;/<span style="font-weight:700">book</span>></span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">category</span>></span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">books</span>></span>
</pre>

          <h3>Code:</h3>

          <pre style="background:#fff;color:#000;border:0;">XMLReader    *reader    = <span style="color:#585cf6;font-weight:700">NULL</span>;
    XMLDocument  *document  = <span style="color:#585cf6;font-weight:700">NULL</span>;
    XMLElement   *element   = <span style="color:#585cf6;font-weight:700">NULL</span>;
    XMLElement   *element_t = <span style="color:#585cf6;font-weight:700">NULL</span>;
    XMLElement   *element_c = <span style="color:#585cf6;font-weight:700">NULL</span>; <span style="color:#06f;font-style:italic">/* the pointer to book's category */</span>
    XMLElement   *element_b = <span style="color:#585cf6;font-weight:700">NULL</span>; <span style="color:#06f;font-style:italic">/* the pointer to book entry */</span>
    XMLAttribute *attribute = <span style="color:#585cf6;font-weight:700">NULL</span>;
    
    wchar_t *element_value    = <span style="color:#585cf6;font-weight:700">NULL</span>;
    wchar_t *attribute_value  = <span style="color:#585cf6;font-weight:700">NULL</span>;

    <span style="color:#00f;font-weight:700">char</span> file_name[] = <span style="color:#036a07">"/tmp/installer-xml_reader_example2"</span>;

    <span style="color:#0000a2;font-weight:700">setlocale</span>(LC_ALL, "en_US.UTF-8");

    pointer = fopen(file_name, <span style="color:#036a07">"r"</span>);
    <span style="color:#00f;font-weight:700">if</span> (pointer == <span style="color:#585cf6;font-weight:700">NULL</span>) {
        fprintf(stderr, "[ERROR|%s] %s - %s\n",
                "u_installer_xml_example_example2", file_name, strerror(errno));
        return false;
    }
    
    <span style="color:#06f;font-style:italic">/* read the file and verifying the structure */</span>
    reader   = installer_xml_reader_new(pointer);
    <span style="color:#00f;font-weight:700">if</span> (reader == <span style="color:#585cf6;font-weight:700">NULL</span>) {
        u_installer_main_print("xml_example", "<span style="color:#0000a2;font-weight:700">example2</span>(1)", false);
        return false;
    }
    
    document = installer_xml_reader_read(reader);
    <span style="color:#00f;font-weight:700">if</span> ((document == <span style="color:#585cf6;font-weight:700">NULL</span>) || (document->elements == <span style="color:#585cf6;font-weight:700">NULL</span>)) {
        u_installer_main_print("xml_example", "<span style="color:#0000a2;font-weight:700">example2</span>(2)", false);
        return false;
    }
    
    <span style="color:#06f;font-style:italic">/* 
     * main example code 
     */</span>
     
    <span style="color:#06f;font-style:italic">/* XML DOCUMENT v1.0 */</span>
    element = installer_xml_document_get_element(document, <span style="color:#585cf6;font-weight:700">NULL</span>);
    
    <span style="color:#06f;font-style:italic">/* &lt;?xml version="1.0" encoding="UTF-8"?> */</span>
    element_t = installer_xml_element_get_element(element, <span style="color:#585cf6;font-weight:700">NULL</span>);
    
    <span style="color:#06f;font-style:italic">/* &lt;books> */</span>
    element = installer_xml_element_get_element(element, element_t);
    
    <span style="color:#06f;font-style:italic">/* nullify temporary pointer to use it as iterator */</span>
    <span style="color:#00f;font-weight:700">while</span> ((element_c = installer_xml_element_get_element(element, element_c)) != <span style="color:#585cf6;font-weight:700">NULL</span>) {
        attribute       = installer_xml_element_get_attribute(element_c, NULL);
        attribute_value = installer_xml_attribute_get_value(attribute);
        printf("%ls\n", attribute_value);
        
        while ((element_b = installer_xml_element_get_element(element_c, element_b)) != NULL) {
            element_value   = installer_xml_element_get_value(element_b);
            attribute       = installer_xml_element_get_attribute(element_b, NULL);
            attribute_value = installer_xml_attribute_get_value(attribute);
            printf("\t%ls by %ls ", element_value, attribute_value);
            
            attribute       = installer_xml_element_get_attribute(element_b, attribute);
            attribute_value = installer_xml_attribute_get_value(attribute);
            printf("(%ls)\n", attribute_value);
        }
    }
    
    <span style="color:#06f;font-style:italic">/* free memory and remove temporary file */</span>
    <span style="color:#0000a2;font-weight:700">installer_xml_reader_delete</span>(reader);
    <span style="color:#0000a2;font-weight:700">fclose</span>(pointer);
</pre>

        <h3>Output:</h3>

        <p>
          Art & Photography<br />
            Bookshelf by Alex Johnson (01 May 2012)<br />
            Central Park by Andrew Blauner (24 Apr 2012)<br />
          Romance<br />
            Wicked Nights by Gena Showalter (05 Jul 2012)<br />
            Midnight Rescue by Elle Kennedy (01 May 2012)<br />
          </p>

          <p>You can obtain corresponding code from project source code:
<a href='http://code.google.com/p/installer-core/source/browse/test/util/xml/u_xml_example.h'>http://code.google.com/p/installer-core/source/browse/test/util/xml/u_xml_example.h</a></p>
        </div>
        </div>
        <div id='footer'>
          <div class='container'>
    <footer>
        <hr class='footer-divider' />

        <ul class='piped-links pull-right'>
            <li class='first piped-links-short'><a href='../resume.html'>About</a></li>
            <li class='first piped-links-long'><a href='../resume.html'>About Andrey Pudov</a></li>
            <li><a href='../contact.html'>Contact</a></li>
        </ul>

        <ul class='piped-links'>
            <p class='piped-links-long'>Copyright &#169; 2019 Andrey Pudov. All rights reserved.</p>
        </ul>

        <p class='piped-links-short'>&#169; 2019 Andrey Pudov. All rights reserved.</p>
    </footer>

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src='../libraries/jquery/jquery-1.11.3.min.js'></script>
    <!-- <script src='../libraries/jquery/jquery.validate.min.js'></script> -->

    <!-- <script src='../libraries/bootstrap/js/bootstrap.min.js'></script> -->

    <script src='../libraries/bootstrap/js/collapse.js' ></script>
    <script src='../libraries/bootstrap/js/dropdown.js' ></script>
    <script src='../libraries/bootstrap/js/transition.js' ></script>

    <!-- web page specific scripts declaration -->
    

    <!-- common on init functions -->
    <script src='../scripts/init.js'></script>
</div>
                 
        </div>
      </div>
    </body>
</html>
