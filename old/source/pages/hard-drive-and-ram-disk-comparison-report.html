<?xml version='1.0' encoding='UTF-8' ?>

<!--
 * Official Andrey Pudov website.
 *
 * The MIT License
 *
 * Copyright 2011-2015 Andrey Pudov.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
-->

<!--
    Document   : hard-drive-and-ram-disk-comparison-report.html
    Created on : Jan 18, 2015, 01:50:00 PM
    Author     : Andrey Pudov        <mail@andreypudov.com>
    Description:
        The content web page.
-->
<!DOCTYPE html>
<html>
    <body>
      <define name='title'>
        <title>Andrey Pudov - Hard drive and RAM disk Comparison Report</title>
      </define>
      
      <define name='content'>
        <div class='container'>
          <div class='page-header'>
            <h1>Hard drive and RAM disk Comparison Report<small><em>Thursday, September 22, 2011</em></small></h1>
          </div>

          <p>This report was written in order to compare the performance of hard drives and RAM disks. I wrote a Bash script for test basic file operations implemented in our package building system. The work illustrates of the possibility to use RAM in order to accelerate the build process.</p>

          <h2>Hardware and Software specification</h2>
          
          <ul>
            <li><strong>OS:</strong> Red Hat Enterprise Linux Server release 6.0 (Santiago), Linux version 2.6.32-71.el6.x86_64</li>
            <li><strong>CPU:</strong> Intel® Xeon® Processor X5680 (12M Cache, 3.33 GHz, 6.40 GT/s Intel® QPI) x 2</li>
            <li><strong>Hard drive:</strong> Seagate Constellation ES ST3500514NS 500GB 7200 RPM 32MB Cache SATA 3.0Gb/s 3.5" Enterprise Internal Hard Drive -Bare Drive</li>
            <li><strong>RAM:</strong> 4GB DDR3 SDRAM PC3-10600 1333MHz CL9 x72 ECC Registered DIMM Memory - HYNIX HMT151R7TFR4C-H9 x 8</li>
          </ul>

          <h2>Bash Script Listing</h2>

          <pre>
            <span style='color:#696969; '>#!</span><span style='color:#007997; '>/bin/bash</span>

            function remove_files<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
            <span style='color:#800000; font-weight:bold; '>local</span> path<span style='color:#808030; '>=</span><span style='color:#797997; '>$1</span>
            cd $path
            rm <span style='color:#800000; font-weight:bold; '>-f</span> file<span style='color:#808030; '>*</span>
            <span style='color:#800080; '>}</span>

            function create_files<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
            <span style='color:#800000; font-weight:bold; '>local</span> path<span style='color:#808030; '>=</span><span style='color:#797997; '>$1</span>
            <span style='color:#800000; font-weight:bold; '>local</span> num<span style='color:#808030; '>=</span><span style='color:#797997; '>$2</span>
            <span style='color:#800000; font-weight:bold; '>local</span> size<span style='color:#808030; '>=</span><span style='color:#797997; '>$3</span>

            <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span> $num<span style='color:#800080; '>;</span> <span style='color:#808030; '>+</span><span style='color:#808030; '>+</span>i<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>do</span>
            <span style='color:#808030; '>(</span> dd bs<span style='color:#808030; '>=</span>$size count<span style='color:#808030; '>=</span><span style='color:#008c00; '>1</span> <span style='color:#800000; font-weight:bold; '>if</span><span style='color:#808030; '>=</span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>dev</span><span style='color:#800000; '>/</span>zero of<span style='color:#808030; '>=</span>$path<span style='color:#808030; '>/</span>file<span style='color:#808030; '>-</span>$i <span style='color:#808030; '>)</span> <span style='color:#808030; '>></span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>dev</span><span style='color:#800000; '>/</span>null <span style='color:#008c00; '>2</span><span style='color:#808030; '>></span><span style='color:#808030; '>&amp;</span><span style='color:#008c00; '>1</span>
            done
            <span style='color:#800080; '>}</span>

            function verify_files<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
            <span style='color:#800000; font-weight:bold; '>local</span> path<span style='color:#808030; '>=</span><span style='color:#797997; '>$1</span>

            ls $path<span style='color:#808030; '>/</span>file<span style='color:#808030; '>-</span><span style='color:#808030; '>*</span> <span style='color:#808030; '>|</span> xargs md5sum <span style='color:#808030; '>></span><span style='color:#0000e6; '> </span><span style='color:#800000; '>/</span><span style='color:#0000e6; '>dev</span><span style='color:#800000; '>/</span>null
            <span style='color:#800080; '>}</span>

            function compress_files<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span>
            <span style='color:#800000; font-weight:bold; '>local</span> path<span style='color:#808030; '>=</span><span style='color:#797997; '>$1</span>
            <span style='color:#800000; font-weight:bold; '>local</span> num<span style='color:#808030; '>=</span><span style='color:#797997; '>$2</span>
            <span style='color:#800000; font-weight:bold; '>local</span> speed<span style='color:#808030; '>=</span><span style='color:#797997; '>$3</span> <span style='color:#696969; '># 1 - fastest, 9 - slowest</span>

            <span style='color:#800000; font-weight:bold; '>for</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span>i <span style='color:#808030; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> i <span style='color:#808030; '>&lt;</span> $num<span style='color:#800080; '>;</span> <span style='color:#808030; '>+</span><span style='color:#808030; '>+</span>i<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800000; font-weight:bold; '>do</span>
            gzip <span style='color:#808030; '>-</span>$speed <span style='color:#800000; font-weight:bold; '>-c</span> $path<span style='color:#808030; '>/</span>file<span style='color:#808030; '>-</span>$i <span style='color:#808030; '>></span> $path<span style='color:#808030; '>/</span>file<span style='color:#808030; '>-</span>$i<span style='color:#808030; '>-</span>$speed<span style='color:#808030; '>.</span>gz
            done
            <span style='color:#800080; '>}</span>

            path<span style='color:#808030; '>=</span><span style='color:#0000e6; '>'/work/ram'</span>
            num<span style='color:#808030; '>=</span><span style='color:#008c00; '>40000</span>
            size<span style='color:#808030; '>=</span>$<span style='color:#808030; '>[</span><span style='color:#008c00; '>1024</span><span style='color:#808030; '>]</span>

            echo <span style='color:#0000e6; '>"Number of files: "</span>$num
            echo <span style='color:#0000e6; '>"Size: "</span>$size
            echo <span style='color:#0000e6; '>"Path: "</span>$path
            echo <span style='color:#0000e6; '>""</span>

            start<span style='color:#808030; '>=</span>$<span style='color:#808030; '>(</span>date <span style='color:#808030; '>+</span>%s<span style='color:#808030; '>)</span>
            remove_files $path
            end<span style='color:#808030; '>=</span>$<span style='color:#808030; '>(</span>date <span style='color:#808030; '>+</span>%s<span style='color:#808030; '>)</span>
            diff<span style='color:#808030; '>=</span><span style='color:#797997; '>$(</span><span style='color:#808030; '>(</span>$end <span style='color:#808030; '>-</span> $start<span style='color:#808030; '>)</span><span style='color:#ffffff; background:#dd0000; font-weight:bold; font-style:italic; '>)</span>
            echo <span style='color:#0000e6; '>"Removing: $diff seconds"</span>

            start<span style='color:#808030; '>=</span>$<span style='color:#808030; '>(</span>date <span style='color:#808030; '>+</span>%s<span style='color:#808030; '>)</span>
            create_files $path $num $size
            end<span style='color:#808030; '>=</span>$<span style='color:#808030; '>(</span>date <span style='color:#808030; '>+</span>%s<span style='color:#808030; '>)</span>
            diff<span style='color:#808030; '>=</span><span style='color:#797997; '>$(</span><span style='color:#808030; '>(</span>$end <span style='color:#808030; '>-</span> $start<span style='color:#808030; '>)</span><span style='color:#ffffff; background:#dd0000; font-weight:bold; font-style:italic; '>)</span>
            echo <span style='color:#0000e6; '>"Creating: $diff seconds"</span>
            
            start<span style='color:#808030; '>=</span>$<span style='color:#808030; '>(</span>date <span style='color:#808030; '>+</span>%s<span style='color:#808030; '>)</span>
            verify_files $path
            end<span style='color:#808030; '>=</span>$<span style='color:#808030; '>(</span>date <span style='color:#808030; '>+</span>%s<span style='color:#808030; '>)</span>
            diff<span style='color:#808030; '>=</span><span style='color:#797997; '>$(</span><span style='color:#808030; '>(</span>$end <span style='color:#808030; '>-</span> $start<span style='color:#808030; '>)</span><span style='color:#ffffff; background:#dd0000; font-weight:bold; font-style:italic; '>)</span>
            echo <span style='color:#0000e6; '>"Verifying: $diff seconds"</span>

            start<span style='color:#808030; '>=</span>$<span style='color:#808030; '>(</span>date <span style='color:#808030; '>+</span>%s<span style='color:#808030; '>)</span>
            compress_files $path $num <span style='color:#008c00; '>1</span>
            end<span style='color:#808030; '>=</span>$<span style='color:#808030; '>(</span>date <span style='color:#808030; '>+</span>%s<span style='color:#808030; '>)</span>
            diff<span style='color:#808030; '>=</span><span style='color:#797997; '>$(</span><span style='color:#808030; '>(</span>$end <span style='color:#808030; '>-</span> $start<span style='color:#808030; '>)</span><span style='color:#ffffff; background:#dd0000; font-weight:bold; font-style:italic; '>)</span>
            echo <span style='color:#0000e6; '>"Compressing (fast): $diff seconds"</span>
            
            start<span style='color:#808030; '>=</span>$<span style='color:#808030; '>(</span>date <span style='color:#808030; '>+</span>%s<span style='color:#808030; '>)</span>
            compress_files $path $num <span style='color:#008c00; '>9</span>
            end<span style='color:#808030; '>=</span>$<span style='color:#808030; '>(</span>date <span style='color:#808030; '>+</span>%s<span style='color:#808030; '>)</span>
            diff<span style='color:#808030; '>=</span><span style='color:#797997; '>$(</span><span style='color:#808030; '>(</span>$end <span style='color:#808030; '>-</span> $start<span style='color:#808030; '>)</span><span style='color:#ffffff; background:#dd0000; font-weight:bold; font-style:italic; '>)</span>
            echo <span style='color:#0000e6; '>"Compressing (slow): $diff seconds"</span>
          </pre>

          <h2>Results<small>The results are present in seconds</small></h2>

          <h3>The results of the overall test</h3>

          <div class="panel panel-default">
            <div class="panel-heading">RAM Test for 2000 files</div>

            <table class="table">
              <thead>
                <tr>
                  <th>Size</th>
                  <th>1K</th>
                  <th>10K</th>
                  <th>100K</th>
                  <th>1M</th>
                  <th>10M</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>Removing</th>
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                </tr>
                <tr>
                  <th>Creating</th>
                  <td>4</td>
                  <td>3</td>
                  <td>4</td>
                  <td>8</td>
                  <td>8</td>
                </tr>
                <tr>
                  <th>Verifying</th>
                  <td>0</td>
                  <td>0</td>
                  <td>1</td>
                  <td>4</td>
                  <td>4</td>
                </tr>
                <tr>
                  <th>Compressing (fast)</th>
                  <td>2</td>
                  <td>3</td>
                  <td>4</td>
                  <td>14</td>
                  <td>14</td>
                </tr>
                <tr>
                  <th>Compressing (slow)</th>
                  <td>2</td>
                  <td>2</td>
                  <td>5</td>
                  <td>24</td>
                  <td>24</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">Hard Drive Test for 2000 files</div>

            <table class="table">
              <thead>
                <tr>
                  <th>Size</th>
                  <th>1K</th>
                  <th>10K</th>
                  <th>100K</th>
                  <th>1M</th>
                  <th>10M</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>Removing</th>
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                  <td>1</td>
                  <td>6</td>
                </tr>
                <tr>
                  <th>Creating</th>
                  <td>3</td>
                  <td>3</td>
                  <td>3</td>
                  <td>20</td>
                  <td>285</td>
                </tr>
                <tr>
                  <th>Verifying</th>
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                  <td>25</td>
                  <td>233</td>
                </tr>
                <tr>
                  <th>Compressing (fast)</th>
                  <td>2</td>
                  <td>2</td>
                  <td>3</td>
                  <td>18</td>
                  <td>215</td>
                </tr>
                <tr>
                  <th>Compressing (slow)</th>
                  <td>1</td>
                  <td>2</td>
                  <td>4</td>
                  <td>27</td>
                  <td>211</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h3>Discrete file operations test</h3>

          <div class="panel panel-default">
            <div class="panel-heading">RAM Test for files - size 1024 bytes</div>

            <table class="table">
              <thead>
                <tr>
                  <th>Number of files</th>
                  <th>2000</th>
                  <th>20 000</th>
                  <th>40 000</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>Removing</th>
                  <td>0</td>
                  <td>0</td>
                  <td>4</td>
                </tr>
                <tr>
                  <th>Creating</th>
                  <td>4</td>
                  <td>35</td>
                  <td>100</td>
                </tr>
                <tr>
                  <th>Verifying</th>
                  <td>0</td>
                  <td>0</td>
                  <td>2</td>
                </tr>
                <tr>
                  <th>Compressing (fast)</th>
                  <td>2</td>
                  <td>32</td>
                  <td>132</td>
                </tr>
                <tr>
                  <th>Compressing (slow)</th>
                  <td>2</td>
                  <td>39</td>
                  <td>225</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">Hard Drive Test for files - size 1024 bytes</div>

            <table class="table">
              <thead>
                <tr>
                  <th>Number of files</th>
                  <th>2000</th>
                  <th>20 000</th>
                  <th>40 000</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>Removing</th>
                  <td>33</td>
                  <td>0</td>
                  <td>1</td>
                </tr>
                <tr>
                  <th>Creating</th>
                  <td>2</td>
                  <td>30</td>
                  <td>65</td>
                </tr>
                <tr>
                  <th>Verifying</th>
                  <td>0</td>
                  <td>1</td>
                  <td>2</td>
                </tr>
                <tr>
                  <th>Compressing (fast)</th>
                  <td>2</td>
                  <td>20</td>
                  <td>54</td>
                </tr>
                <tr>
                  <th>Compressing (slow)</th>
                  <td>2</td>
                  <td>20</td>
                  <td>55</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h2>Conclusion</h2>

          <p>RAM disk usage is beneficial for files larger than 100 kilobytes. In another case, the speed of hard drive operations is not inferior to speed of operations in memory.</p>
        </div>
      </define>
    </body>
</html>
